<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Function Composition UI - Phase 1: Scaling & Runtime</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>Serverless Function Platform</h1>
        <p class="subtitle">Phase 1 & 2: Scaling, Runtime, and Networking - Demonstrating UI as Composition Layer</p>
    </header>

    <!-- Function List View -->
    <div id="listView" class="container">
        <section class="list-panel">
            <div class="list-header">
                <h2 id="functionsTitle">Functions (<span id="functionCount">0</span>)</h2>
                <div class="list-header-actions">
                    <button id="createNewBtn" class="btn-primary">Create function</button>
                </div>
            </div>

            <div class="list-controls">
                <input type="text" id="searchInput" class="search-input" placeholder="Search by name or namespace">
            </div>

            <div class="table-container">
                <table class="functions-table">
                    <thead>
                        <tr>
                            <th class="checkbox-column">
                                <input type="checkbox" id="selectAll">
                            </th>
                            <th class="sortable" data-sort="name">
                                Function name
                                <span class="sort-icon">▼</span>
                            </th>
                            <th class="sortable" data-sort="namespace">
                                Namespace
                                <span class="sort-icon">▼</span>
                            </th>
                            <th class="sortable" data-sort="scaling">
                                Scaling
                                <span class="sort-icon">▼</span>
                            </th>
                            <th class="sortable" data-sort="networking">
                                Networking
                                <span class="sort-icon">▼</span>
                            </th>
                            <th class="sortable" data-sort="image">
                                Image
                                <span class="sort-icon">▼</span>
                            </th>
                            <th class="sortable" data-sort="created">
                                Created
                                <span class="sort-icon">▼</span>
                            </th>
                            <th class="actions-column">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="functionsTableBody">
                        <!-- Function rows will be inserted here -->
                    </tbody>
                </table>
                <div id="emptyTableState" class="empty-table-state" style="display: none;">
                    <p>No functions found. Click "Create function" to get started.</p>
                </div>
            </div>
        </section>
    </div>

    <!-- Function Form View -->
    <div id="formView" class="container" style="display: none;">
        <section class="form-panel">
            <div class="form-header">
                <h2 id="formTitle">Create Function</h2>
                <button type="button" id="backToListBtn" class="btn-secondary">← Back to List</button>
            </div>
            <p class="panel-description">Define your function with simple, high-level configuration</p>

            <form id="functionForm">
                <fieldset>
                    <legend>Function Details</legend>

                    <div class="form-group">
                        <label for="functionName">Function Name</label>
                        <input type="text" id="functionName" name="functionName"
                               placeholder="my-function" value="my-function" required>
                    </div>

                    <div class="form-group">
                        <label for="namespace">Namespace</label>
                        <input type="text" id="namespace" name="namespace"
                               placeholder="default" value="default" required>
                    </div>

                    <div class="form-group">
                        <label for="containerImage">Container Image</label>
                        <input type="text" id="containerImage" name="containerImage"
                               placeholder="registry.example.com/functions/my-function:latest"
                               value="registry.example.com/functions/my-function:latest" required>
                    </div>

                    <div class="form-group">
                        <label for="containerPort">Container Port</label>
                        <input type="number" id="containerPort" name="containerPort"
                               placeholder="8080" value="8080" min="1" max="65535" required>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>Scaling Configuration</legend>

                    <!-- Shared replica settings -->
                    <div class="shared-settings">
                        <div class="form-group">
                            <label for="minReplicaCount">Min Replica Count</label>
                            <input type="number" id="minReplicaCount" name="minReplicaCount"
                                   placeholder="0" value="0" min="0">
                            <small class="helper-text">Minimum number of replicas (0 = scale to zero)</small>
                        </div>

                        <div class="form-group">
                            <label for="maxReplicaCount">Max Replica Count</label>
                            <input type="number" id="maxReplicaCount" name="maxReplicaCount"
                                   placeholder="10" value="10" min="1">
                            <small class="helper-text">Maximum number of replicas</small>
                        </div>
                    </div>

                    <div class="scaling-method-label">
                        <label>Scaling Method</label>
                        <small class="helper-text">Choose how to trigger scaling decisions</small>
                    </div>

                    <!-- Concurrency panel -->
                    <div id="concurrencyPanel" class="metric-panel active">
                        <label class="panel-header">
                            <input type="radio" name="scalingMetric" value="concurrency" checked>
                            <span class="panel-icon">▼</span>
                            <span class="panel-title">HTTP Concurrency</span>
                        </label>
                        <div class="panel-body">
                            <div class="form-group">
                                <label for="concurrencyTargetValue">Target Concurrent Requests</label>
                                <input type="number" id="concurrencyTargetValue" name="concurrencyTargetValue"
                                       placeholder="100" value="100" min="1">
                                <small class="helper-text">Target number of concurrent requests per instance</small>
                            </div>
                        </div>
                    </div>

                    <!-- Request Rate panel -->
                    <div id="requestRatePanel" class="metric-panel">
                        <label class="panel-header">
                            <input type="radio" name="scalingMetric" value="requestRate">
                            <span class="panel-icon">▶</span>
                            <span class="panel-title">HTTP Request Rate</span>
                        </label>
                        <div class="panel-body">
                            <div class="form-group">
                                <label for="requestRateTargetValue">Target Request Rate</label>
                                <input type="number" id="requestRateTargetValue" name="requestRateTargetValue"
                                       placeholder="100" value="100" min="1">
                                <small class="helper-text">Target requests per second</small>
                            </div>

                            <div class="form-group">
                                <label for="requestRateWindow">Aggregation Window</label>
                                <input type="text" id="requestRateWindow" name="requestRateWindow"
                                       placeholder="1m" value="1m">
                                <small class="helper-text">Time window for aggregating metrics (e.g., "1m", "30s")</small>
                            </div>

                            <div class="form-group">
                                <label for="requestRateGranularity">Metric Granularity</label>
                                <input type="text" id="requestRateGranularity" name="requestRateGranularity"
                                       placeholder="1s" value="1s">
                                <small class="helper-text">Granularity for metric calculation (e.g., "1s", "500ms")</small>
                            </div>
                        </div>
                    </div>

                    <!-- ScaledObject panel -->
                    <div id="scaledObjectPanel" class="metric-panel">
                        <label class="panel-header">
                            <input type="radio" name="scalingMetric" value="scaledObject">
                            <span class="panel-icon">▶</span>
                            <span class="panel-title">KEDA Triggers</span>
                        </label>
                        <div class="panel-body">
                            <div class="form-group">
                                <label for="triggerType">Trigger Type</label>
                                <select id="triggerType" name="triggerType">
                                    <option value="cpu">CPU</option>
                                    <option value="memory">Memory</option>
                                    <option value="prometheus">Prometheus</option>
                                    <option value="kafka">Kafka</option>
                                    <option value="rabbitmq">RabbitMQ</option>
                                    <option value="redis">Redis</option>
                                    <option value="cron">Cron</option>
                                    <option value="custom">Custom (define your own)</option>
                                </select>
                                <small class="helper-text">Choose a template or define a custom trigger</small>
                            </div>

                            <!-- CPU trigger fields -->
                            <div id="cpuTriggerFields" class="trigger-fields">
                                <div class="form-group">
                                    <label for="cpuUtilization">CPU Utilization (%)</label>
                                    <input type="number" id="cpuUtilization" name="cpuUtilization"
                                           placeholder="80" value="80" min="1" max="100">
                                    <small class="helper-text">Target CPU utilization percentage</small>
                                </div>
                            </div>

                            <!-- Memory trigger fields -->
                            <div id="memoryTriggerFields" class="trigger-fields" style="display: none;">
                                <div class="form-group">
                                    <label for="memoryUtilization">Memory Utilization (%)</label>
                                    <input type="number" id="memoryUtilization" name="memoryUtilization"
                                           placeholder="80" value="80" min="1" max="100">
                                    <small class="helper-text">Target memory utilization percentage</small>
                                </div>
                            </div>

                            <!-- Prometheus trigger fields -->
                            <div id="prometheusTriggerFields" class="trigger-fields" style="display: none;">
                                <div class="form-group">
                                    <label for="prometheusServerAddress">Prometheus Server Address</label>
                                    <input type="text" id="prometheusServerAddress" name="prometheusServerAddress"
                                           placeholder="http://prometheus:9090" value="http://prometheus:9090">
                                    <small class="helper-text">Prometheus server URL</small>
                                </div>

                                <div class="form-group">
                                    <label for="prometheusQuery">Prometheus Query</label>
                                    <input type="text" id="prometheusQuery" name="prometheusQuery"
                                           placeholder="http_requests_total" value="http_requests_total">
                                    <small class="helper-text">PromQL query for the metric</small>
                                </div>

                                <div class="form-group">
                                    <label for="prometheusThreshold">Threshold</label>
                                    <input type="number" id="prometheusThreshold" name="prometheusThreshold"
                                           placeholder="100" value="100" min="1">
                                    <small class="helper-text">Scale when metric exceeds this value</small>
                                </div>
                            </div>

                            <!-- Cron trigger fields -->
                            <div id="cronTriggerFields" class="trigger-fields" style="display: none;">
                                <div class="form-group">
                                    <label for="cronTimezone">Timezone</label>
                                    <input type="text" id="cronTimezone" name="cronTimezone"
                                           placeholder="UTC" value="UTC">
                                    <small class="helper-text">Timezone for cron schedule (e.g., "UTC", "America/New_York")</small>
                                </div>

                                <div class="form-group">
                                    <label for="cronStart">Start Schedule</label>
                                    <input type="text" id="cronStart" name="cronStart"
                                           placeholder="0 8 * * *" value="0 8 * * *">
                                    <small class="helper-text">Cron expression for scaling up (e.g., "0 8 * * *" = 8 AM daily)</small>
                                </div>

                                <div class="form-group">
                                    <label for="cronEnd">End Schedule</label>
                                    <input type="text" id="cronEnd" name="cronEnd"
                                           placeholder="0 18 * * *" value="0 18 * * *">
                                    <small class="helper-text">Cron expression for scaling down (e.g., "0 18 * * *" = 6 PM daily)</small>
                                </div>

                                <div class="form-group">
                                    <label for="cronDesiredReplicas">Desired Replicas (during active period)</label>
                                    <input type="number" id="cronDesiredReplicas" name="cronDesiredReplicas"
                                           placeholder="5" value="5" min="1">
                                    <small class="helper-text">Number of replicas during active period</small>
                                </div>
                            </div>

                            <!-- Kafka trigger fields -->
                            <div id="kafkaTriggerFields" class="trigger-fields" style="display: none;">
                                <div class="form-group">
                                    <label for="kafkaBootstrapServers">Bootstrap Servers</label>
                                    <input type="text" id="kafkaBootstrapServers" name="kafkaBootstrapServers"
                                           placeholder="kafka:9092" value="kafka:9092">
                                    <small class="helper-text">Kafka bootstrap servers (comma-separated)</small>
                                </div>

                                <div class="form-group">
                                    <label for="kafkaTopic">Topic</label>
                                    <input type="text" id="kafkaTopic" name="kafkaTopic"
                                           placeholder="my-topic" value="my-topic">
                                    <small class="helper-text">Kafka topic name</small>
                                </div>

                                <div class="form-group">
                                    <label for="kafkaConsumerGroup">Consumer Group</label>
                                    <input type="text" id="kafkaConsumerGroup" name="kafkaConsumerGroup"
                                           placeholder="my-consumer-group" value="my-consumer-group">
                                    <small class="helper-text">Kafka consumer group ID</small>
                                </div>

                                <div class="form-group">
                                    <label for="kafkaLagThreshold">Lag Threshold</label>
                                    <input type="number" id="kafkaLagThreshold" name="kafkaLagThreshold"
                                           placeholder="10" value="10" min="1">
                                    <small class="helper-text">Scale when consumer lag exceeds this value</small>
                                </div>
                            </div>

                            <!-- RabbitMQ trigger fields -->
                            <div id="rabbitmqTriggerFields" class="trigger-fields" style="display: none;">
                                <div class="form-group">
                                    <label for="rabbitmqHost">Host URI</label>
                                    <input type="text" id="rabbitmqHost" name="rabbitmqHost"
                                           placeholder="amqp://guest:guest@rabbitmq:5672/" value="amqp://guest:guest@rabbitmq:5672/">
                                    <small class="helper-text">RabbitMQ connection URI</small>
                                </div>

                                <div class="form-group">
                                    <label for="rabbitmqQueueName">Queue Name</label>
                                    <input type="text" id="rabbitmqQueueName" name="rabbitmqQueueName"
                                           placeholder="my-queue" value="my-queue">
                                    <small class="helper-text">RabbitMQ queue name</small>
                                </div>

                                <div class="form-group">
                                    <label for="rabbitmqQueueLength">Queue Length Threshold</label>
                                    <input type="number" id="rabbitmqQueueLength" name="rabbitmqQueueLength"
                                           placeholder="20" value="20" min="1">
                                    <small class="helper-text">Scale when queue length exceeds this value</small>
                                </div>
                            </div>

                            <!-- Redis trigger fields -->
                            <div id="redisTriggerFields" class="trigger-fields" style="display: none;">
                                <div class="form-group">
                                    <label for="redisAddress">Redis Address</label>
                                    <input type="text" id="redisAddress" name="redisAddress"
                                           placeholder="redis:6379" value="redis:6379">
                                    <small class="helper-text">Redis server address</small>
                                </div>

                                <div class="form-group">
                                    <label for="redisListName">List Name</label>
                                    <input type="text" id="redisListName" name="redisListName"
                                           placeholder="my-list" value="my-list">
                                    <small class="helper-text">Redis list name</small>
                                </div>

                                <div class="form-group">
                                    <label for="redisListLength">List Length Threshold</label>
                                    <input type="number" id="redisListLength" name="redisListLength"
                                           placeholder="5" value="5" min="1">
                                    <small class="helper-text">Scale when list length exceeds this value</small>
                                </div>
                            </div>

                            <!-- Custom trigger fields -->
                            <div id="customTriggerFields" class="trigger-fields" style="display: none;">
                                <div class="form-group">
                                    <label for="customTriggerType">Custom Trigger Type</label>
                                    <input type="text" id="customTriggerType" name="customTriggerType"
                                           placeholder="aws-sqs-queue" value="">
                                    <small class="helper-text">KEDA scaler type (e.g., "aws-sqs-queue", "azure-queue", "gcp-pubsub")</small>
                                </div>

                                <div class="form-group">
                                    <label for="customTriggerMetadata">Trigger Metadata (YAML)</label>
                                    <textarea id="customTriggerMetadata" name="customTriggerMetadata" rows="8" placeholder="queueURL: https://sqs.us-east-1.amazonaws.com/123456/my-queue
queueLength: &quot;10&quot;
awsRegion: us-east-1"></textarea>
                                    <small class="helper-text">
                                        Write the metadata fields in YAML format (key: value pairs).
                                        All values are strings. See <a href="https://keda.sh/docs/2.18/scalers/" target="_blank">KEDA scalers</a> for required fields.
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>Networking Configuration</legend>

                    <div class="scaling-method-label">
                        <label>Networking Method</label>
                        <small class="helper-text">Choose how to expose your function externally</small>
                    </div>

                    <!-- No External Access panel -->
                    <div id="noAccessPanel" class="metric-panel active">
                        <label class="panel-header">
                            <input type="radio" name="networkingMethod" value="none" checked>
                            <span class="panel-icon">▼</span>
                            <span class="panel-title">No External Access</span>
                        </label>
                        <div class="panel-body">
                            <p class="helper-text">Function is only accessible within the cluster via the Service.</p>
                        </div>
                    </div>

                    <!-- Gateway API panel -->
                    <div id="gatewayAPIPanel" class="metric-panel">
                        <label class="panel-header">
                            <input type="radio" name="networkingMethod" value="gateway">
                            <span class="panel-icon">▶</span>
                            <span class="panel-title">Gateway API (HTTPRoute)</span>
                        </label>
                        <div class="panel-body">
                            <div class="form-group">
                                <label for="gatewayName">Gateway Name</label>
                                <input type="text" id="gatewayName" name="gatewayName"
                                       placeholder="default-gateway" value="default-gateway">
                                <small class="helper-text">Name of the Gateway to attach to</small>
                            </div>

                            <div class="form-group">
                                <label for="gatewayHostname">Hostname (optional)</label>
                                <input type="text" id="gatewayHostname" name="gatewayHostname"
                                       placeholder="my-function.example.com" value="">
                                <small class="helper-text">Optional: custom hostname for the route (leave empty for wildcard)</small>
                            </div>

                            <div class="form-group">
                                <label for="gatewayPath">Path</label>
                                <input type="text" id="gatewayPath" name="gatewayPath"
                                       placeholder="/" value="/">
                                <small class="helper-text">URL path prefix (e.g., '/', '/api/v1')</small>
                            </div>
                        </div>
                    </div>

                    <!-- Ingress panel -->
                    <div id="ingressPanel" class="metric-panel">
                        <label class="panel-header">
                            <input type="radio" name="networkingMethod" value="ingress">
                            <span class="panel-icon">▶</span>
                            <span class="panel-title">Ingress</span>
                        </label>
                        <div class="panel-body">
                            <div class="form-group">
                                <label for="ingressClass">Ingress Class (optional)</label>
                                <input type="text" id="ingressClass" name="ingressClass"
                                       placeholder="nginx" value="">
                                <small class="helper-text">Optional: specify ingress controller class</small>
                            </div>

                            <div class="form-group">
                                <label for="ingressHostname">Hostname</label>
                                <input type="text" id="ingressHostname" name="ingressHostname"
                                       placeholder="my-function.example.com" value="my-function.example.com">
                                <small class="helper-text">Hostname for the ingress rule</small>
                            </div>

                            <div class="form-group">
                                <label for="ingressPath">Path</label>
                                <input type="text" id="ingressPath" name="ingressPath"
                                       placeholder="/" value="/">
                                <small class="helper-text">URL path (e.g., '/', '/api')</small>
                            </div>

                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="ingressTLSEnabled" name="ingressTLSEnabled">
                                    Enable TLS
                                </label>
                            </div>

                            <div id="ingressTLSFields" style="display: none;">
                                <div class="form-group">
                                    <label for="ingressTLSSecretName">TLS Secret Name</label>
                                    <input type="text" id="ingressTLSSecretName" name="ingressTLSSecretName"
                                           placeholder="my-function-tls" value="my-function-tls">
                                    <small class="helper-text">Name of the TLS secret containing cert and key</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- OpenShift Route panel -->
                    <div id="routePanel" class="metric-panel">
                        <label class="panel-header">
                            <input type="radio" name="networkingMethod" value="route">
                            <span class="panel-icon">▶</span>
                            <span class="panel-title">OpenShift Route</span>
                        </label>
                        <div class="panel-body">
                            <div class="form-group">
                                <label for="routeHostname">Hostname (optional)</label>
                                <input type="text" id="routeHostname" name="routeHostname"
                                       placeholder="" value="">
                                <small class="helper-text">Optional: custom hostname (leave empty for auto-generated)</small>
                            </div>

                            <div class="form-group">
                                <label for="routePath">Path</label>
                                <input type="text" id="routePath" name="routePath"
                                       placeholder="/" value="/">
                                <small class="helper-text">URL path prefix</small>
                            </div>

                            <div class="form-group">
                                <label for="routeTLSTermination">TLS Termination</label>
                                <select id="routeTLSTermination" name="routeTLSTermination">
                                    <option value="none">None</option>
                                    <option value="edge" selected>Edge</option>
                                    <option value="passthrough">Passthrough</option>
                                    <option value="reencrypt">Re-encrypt</option>
                                </select>
                                <small class="helper-text">TLS termination type</small>
                            </div>
                        </div>
                    </div>
                </fieldset>

                <button type="submit" class="btn-primary">Create Function</button>
            </form>
        </section>

        <!-- Right Panel: Resources View -->
        <section class="resources-panel">
            <h2>Results</h2>
            <p class="panel-description">See how the UI composes multiple Kubernetes resources</p>

            <!-- User View Section -->
            <div id="userView" class="user-view" style="display: none;">
                <h3>What User Thinks</h3>
                <div class="user-message">
                    <p id="userMessage"></p>
                </div>
            </div>

            <!-- Platform View Section -->
            <div id="platformView" class="platform-view" style="display: none;">
                <h3>What UI Creates</h3>
                <p id="platformDescription" class="platform-description">
                    The UI composed <strong id="resourceCount">3</strong> Kubernetes resources from your simple form input.
                    You never had to understand Deployment, Service, or KEDA scaling APIs.
                </p>

                <div id="resourceCards" class="resource-cards">
                    <!-- Resource cards will be inserted here by JavaScript -->
                </div>
            </div>

            <!-- Initial empty state -->
            <div id="emptyState" class="empty-state">
                <p>Fill in the form and click "Create Function" to see the composed resources.</p>
            </div>
        </section>
    </div>

    <footer>
        <p>
            This prototype demonstrates the concept from
            <a href="../spec/README.md" target="_blank">002/spec/README.md</a>
        </p>
    </footer>

    <script src="templates.js"></script>
    <script src="state.js"></script>
    <script src="app.js"></script>
</body>
</html>
